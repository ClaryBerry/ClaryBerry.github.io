<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OpenWidget with Custom Button + GTM</title>
  <style>
    /* 自绘按钮样式 */
    #custom-openwidget-btn {
      width: 140px;
      height: 140px;
      background-color: #FF5722; /* 桌面端橙色 */
      border-radius: 50%;
      position: fixed;
      bottom: 30px;
      right: 40px;
      z-index: 999999;
      display: flex;
      justify-content: center;
      align-items: center;
      border: none;
      cursor: pointer;
      font-weight: bold;
      color: white;
      font-size: 16px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      transition: transform 0.1s;
    }

    /* 点击缩放效果 */
    #custom-openwidget-btn:active {
      transform: scale(0.95);
    }

    /* 隐藏原始按钮（桌面端 class 示例） */
    .css-1n4pdgy {
      display: none !important;
    }
  </style>
</head>
<body>

  <!-- GTM Container -->
  <script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-ND9SKQL4');
  </script>

  <!-- 自绘按钮 -->
  <button id="custom-openwidget-btn">Chat</button>

  <script>
  (function(){
    var btn = document.getElementById('custom-openwidget-btn');

    // 安全点击事件：保证 LC_API 已加载
    btn.addEventListener('click', function(){
      var tryOpen = function(retries){
        if(window.LC_API && typeof window.LC_API.open === 'function'){
          LC_API.open();
        } else if(retries > 0){
          setTimeout(function(){ tryOpen(retries - 1); }, 300);
        } else {
          console.log('OpenWidget API 未加载');
        }
      };
      tryOpen(10); // 最多尝试 10 次，每次间隔 300ms
    });

    // 隐藏原按钮（反复尝试，防止 Widget 延迟渲染）
    var hideOriginal = function(){
      var originalBtn = document.querySelector('.css-1n4pdgy'); // 桌面端按钮 class
      if(originalBtn){
        originalBtn.style.display = 'none';
      }
    };
    var attempts = 0;
    var maxAttempts = 30;
    var interval = setInterval(function(){
      hideOriginal();
      attempts++;
      if(attempts > maxAttempts) clearInterval(interval);
    }, 500);
  })();
  </script>

</body>
</html>
